# 안드로이드 앱이 실행되기까지

## 김현수

```
자바 소스 파일 → .dex 파일 → .apk 파일 → 다운로드 → 인스톨
```

위와 같은 설치 과정을 거친 안드로이드 어플리케이션은 아래의 과정을 거쳐 실행된다고 볼 수 있다.

```
부트 로더 → 리눅스 커널 → init → 데몬, 컨텍스트매니저, 미디어 서버, Zygote → Zygote → 시스템 서버 → Activity Manager Servie → 액티비티 생명주기 발생
```

### Dalvik Virtual Machine
- Java/C/C++로 작성된 레지스터 기반의 가상머신, JVM보다 명령이 단순하고 속도가 빠름
- 하나의 디바이스에서 효율적으로 여러개의 가상머신을 실행할 수 있게 한다.
- dx를 이용하여 .dex 포맷으로 변경하여, 자바 컴파일러에 의해 컴파일된 클래스를 실행한다.
> Lolipop(API 21) 이후 Dalvik 대신 ART(Android RunTime)이 적용됨

### ART 
- ART는 Android RunTime을 의미하며 응용 프로그램 실행을 처리하는 방식은 JIT (Just-In-Time) 컴파일러를 사용하여 바이트 코드를 해석하는 Dalvik과 완전히 다르다.
- 개발자의 컴파일 된 application program code는 interpreter를 통해 사용자의 장치에서 실행되어야 한다. 이 메커니즘은 비효율적이지만 다른 하드웨어 및 아키텍처에서 응용 프로그램을보다 쉽게 실행할 수 있다.
- ART는 이러한 관행을 완전히 변경하였으며, app이 설치 될 때 dex2oat 도구는 DEX 파일을 machine code 파일로 직접 변환하는 데 사용되며, 실행될 때 기계 코드 모드에서 실행되므로 시스템 성능을 최대한 활용할 수 있다.

### Zygote
- 안드로이드 앱에서 공통적으로 필요로 하는 자원, 라이브러리 등을 미리 로드시킨 후 대기하다가 새로운 애플리케이션 실행 시에 간단하게 자신을 fork 하는 메커니즘
- 만약 애플리케이션 실행 시 마다 메모리 및 자원을 할당하고 로드하고 등의 작업을 한다면 부하가 많이 걸릴 것이다.
- 대신 Zygote라는 프로세스를 미리 만들어 놓아서 대기시킨 후 애플리케이션 실행 시에 fork를 통해 복사하여 필요한 부분 즉 실행시킬 애플리케이션과 관련된 부분만 처리해 준다면 중복된 행위를 통한 낭비를 줄일 수 있다.
