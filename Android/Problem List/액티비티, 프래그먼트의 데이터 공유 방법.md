# 액티비티, 프래그먼트의 데이터 공유 방법
## 김민수

프래그먼트는 재사용을 염두해 둔 컴포넌트이다. 따라서 프래그먼트를 독립적으로 유지하려면, 다른 프래그먼트 혹은 액티비티와 직접적으로 통신해선 안된다.(직접 통신하는게 쉽긴 하다.)

ViewModel을 사용해야 하는 경우

- 영속적인 데이터를 공유할 때

Fragment Result Api를 사용하는 경우

- 일회성 데이터를 주고 받을 때

### ViewModel

> 뷰모델은 액티비티, 프래그먼트 등 수명주기를 갖는 컴포넌트의 UI 관련 데이터를 저장하고 관리한다. 기기 회전을 했을 경우, 액티비티, 프래그먼트는 destroy되고 다시 create 된다. 이때 각 컴포넌트가 갖고있는 화면의 데이터는 초기화 된다. Bundle을 이용하여 저장할 수 있지만 번들의 저장용량 권장 사항이 50kb이며 메인 스레드가 번들을 처리하기 때문에 반응성이 떨어진다. 이런 문제점을 해결하기 위해 뷰모델을 사용한다.

뷰모델은 여러 프래그먼트 혹은 액티비티와 데이터를 공유해야 할 때, 가장 적합한 방법이다.

- 호스트 액티비티와 데이터 공유
- 프래그먼트 간 데이터 공유
- 부모, 자식 프래그먼트 간 데이터 공유

프래그먼트는 기본적으로 액티비티에 의존적인 요소이다. 이때, 뷰모델의 소유자를 액티비티에 지정하고, 호출된 프래그먼트에 `activityViewModels()`라는 대리자를 통해 뷰모델에 접근할 수 있다. 

자식 프래그먼트에서는 `requireParentFragment()`를 이용하여 부모 프래그먼트의 뷰모델에 접근 가능하다.

### Fragment Result API

> 프래그먼트 매니저가 상속받은 인터페이스 `FragmentResultOwner`를 통해 결과 값을 받을 수 있다. 결과를 받고 싶은 액티비티 혹은 프래그먼트의 매니저의 메서드 `setFragmentResultListener`의 인자 리스너를 통해 결과를 받을 수 있다. 자식 프래그먼트의 결과를 받고 싶다면 childFragmentManager를 통해 받을 수 있다.

- 호스트 액티비티에서 결과 수신

- 프래그먼트 간 결과 전달

  <img src="https://developer.android.com/images/guide/fragments/fragment-a-to-b.png" style width="500"/>

  

- 부모, 자식 프래그먼트 간 결과 전달

  <img src="https://developer.android.com/images/guide/fragments/pass-parent-child.png" style width="500"/>
