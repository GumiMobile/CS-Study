# ANR, 발생 시 대처 방법

## 김민수

### ANR

Application Not Responding의 약자로 애플리케이션이 반응하지 않을 때 발생한다. 앱의 메인 스레드(UI 스레드)가 일정시간 어떤 작업에 묶여 있으면 사용자의 입력처리를 할 수 없고 사용자는 앱이 응답하지 않는 경험을 한다.

### ANR 발생 요인

안드로이드 시스템은 아래 두가지 조건 중 하나를 감지하면 ANR 대화상자를 띄운다.

- 입력 이벤트(터치, 키 입력)에 대해 5초 이내에 응답하지 않음

- 브로드캐스트 리시버가 10초 이내에 실행을 완료하지 못함

  > 브로드캐스트 리시버, 서비스의 기본 동작도 메인 스레드에서 이뤄진다. 다만 서비스는 서브 스레드에서 구현된다.


### ANR 회피 및 대처 방법

1. 장시간 작업이 필요한 경우, 메인 스레드 외 다른 스레드에서 비동기 처리를 해야한다.

   - 워커 스레드 생성

   - AsyncTask 사용

   - Coroutine 사용

2. 사용자에게 작업의 진행 과정을 안내하여(프로그레스 바, 로딩 ui) 기다리게 한다.
   - 워커 스레드에서 메인 스레드로 UI 작업 전달
     - 메인 스레드의 핸들러로 Runnable 전달
     - Activity.runOnUiThread(Runnable)
     - View.post(Runnable)
   - AsyncTask의 `onProgressUpdate()`를 구현하고 `publishProgress()` 호출
   - IO 스코프에서 장기 작업을 진행하고 Main 스코프에서 UI 작업 실행
