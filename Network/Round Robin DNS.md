# Round Robin DNS
## 이유진
### 라운드 로빈 DNS
별도의 소프트웨어 혹은 하드웨어 로드밸런싱 장비를 사용하지 않고,  DNS만을 이용하여 도메인 레코드 정보를 조회하는 시점에서 트래픽을 분산하는 기법
웹에서 사용하는 HTTP/HTTPS 뿐 아니라 도메인을 사용하는 모든 서비스(FTP, SMTP 등)에서 사용할 수 있다.

#### DNS(Domain Name System)
네트워크 계층(L3)에서는 도메인을 IP주소로 변경하기 위해 DNS를 사용한다. 웹 사이트 접속을 위해 사용자가 도메인 주소를 입력하면, DNS가 도메인 정보를 조회해서 IP주소를 사용자에게 알려준다.

#### 라운드 로빈 DNS 원리
일반적인 도메인은 하나의 IP주소가 할당되어있지만, 하나의 도메인에 여러 개의 공인 IP주소가 할당되어있는 경우가 있다. 이러한 경우, DNS에서 레코드 정보를 조회하는 시점에 여러 IP중 라운드 로빈 형태로 하나 또는 여러 개를 선택하여 사용자에게 알려준다. 사용자는 각각의 IP에 접속하게 되므로, 자연스럽게 각 서버의 부하가 분산된다.
> 이전에는 DNS조회 결과로 1개의 IP만 반환되었지만, 최근에는 복수의 IP를 순서를 정해서 제공하고 클라이언트가 접속할 IP를 선택하도록 한다.

> (참고)   
> 권한 없는 응답의 Addresses 부분이 할당된 IP
>
> 도메인에 IP주소가 하나만 할당된 경우
> ```
> >nslookup google.com
> 서버:    kns.kornet.net
> Address:  168.126.63.1
> 
> 권한 없는 응답:
> 이름:    google.com
> Addresses:  2404:6800:4004:80f::200e
>           142.250.196.142
> ```
> 도메인에 IP주소가 여러개 할당된 경우
> ```
> >nslookup naver.com
> 서버:    kns.kornet.net
> Address:  168.126.63.1
> 
> 권한 없는 응답:
> 이름:    naver.com
> Addresses:  125.209.222.141
>           223.130.195.200
>           125.209.222.142
>           223.130.195.95
> ```

#### 장점 & 단점
- 장점
  - 적은 비용으로 트래픽을 분산할 수 있다.
  - 지리적으로 복수의 웹 서버가 멀리 떨어져 있어서 실시간으로 헬스 체크가 어려울 때 사용한다.
- 단점
  - 세션이 필요한 경우, DNS쿼리 주소가 변경되어 기본 세션이 끊어지는 경우가 발생할 수 있다. <br>=> 세션을 공유하는 기술을 사용 | 쿠키값을 이용해서 동일 서버로 접속
  - 헬스 체크 기능이 없기 때문에 목록에 있는 IP주소 중 하나가 서비스에 실패해도 DNS는 해당 IP를 계속 제공하고, 클라이언트는 작동 불가능한 서비스에 도달하려고 계속 시도하게 된다. 이는 서비스 장애로 나타날 수 있다. 따라서 무중단 서비스에서 라운드로빈 DNS를 사용하면 안 된다. <br>이러한 문제를 해결하기 위해 GLSB를 사용한다. (대략 주기적인 헬스체크를 수행하는 방식)
> **Health Check?**  
> 어플리케이션이 정상적으로 동작하는지 확인하는 것
클라이언트들이 어떤 서버를 사용할 것인지 결정하기 때문에 낮은 비용으로 여러 대의 서버로 트래픽을 분산하는 장점이 있다.

## 우지현

### Round Robin DNS

Round Robin DNS는 서버에 요청을 보낼 때 DNS에 서버의 IP를 요청한다는 점에 착안하여 만들어진 방법이다. 클라이언트가 어떤 요청을 보내기 위해선 DNS에 서버의 IP를 먼저 요청해야 한다. Round Robin DNS는 이러한 요청이 들어올 때 DNS에서 각 서비스의 서버에 해당하는 IP를 Round Robin으로 제공해주는 방법이다.

> 💡 DNS (Domain Name System)
>
> ![DNS](https://blog-imgs-136-origin.fc2.com/d/a/i/dailusia/img.png)
>
> 숫자로 구성된 네트워크 주소인 IP 주소를 사람이 이해하기 쉬운 명칭인 도메인 이름으로 상호 매칭시켜주는 시스템

### Round Robin 원리

![라운드 로빈 DNS를 이용한 로드 밸런싱](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FyY2sc%2Fbtq4VBpjmAM%2FkSvBRPxrUUwGKVObTd08k1%2Fimg.png)

- 웹 서비스를 담당할 여러 대의 웹 서버는 자신의 공인 IP를 각각 가지고 있다.
- 사이트 접속을 위해 사용자가 해당 도메인 주소를 브라우저에 입력하면 DNS는 도메인 정보를 조회하는데 이때 IP 주소를 여러 대의 서버 IP 리스트 중에서 라운드 로빈 형태로 랜덤하게 하나 혹은 여러 개를 선택하여 사용자에게 알려준다.
- 결과적으로 웹 사이트에 접속하는 다수의 사용자는 실제로는 복수의 웹 서버에 나뉘어 접속하게 되면서 자연스럽게 서버의 부하가 분산된다.

### Round Robin의 문제점

1. 서버의 수만큼 공인 IP 주소가 필요하다.

   부하 분산을 위해 서버의 대수를 늘리기 위해서는 그만큼의 공인 IP가 필요하다.

2. 균등하게 분산되지 않는다.

   모바일 사이트 등에서 문제가 될 수 있는데, 스마트폰의 접속은 캐리어 게이트웨이라고 하는 프록시 서버를 경유 한다. 프록시 서버에서는 이름변환 결과가 일정 시간 동안 캐싱되므로 같은 프록시 서버를 경유 하는 접속은 항상 같은 서버로 접속된다. 또한 PC 용 웹 브라우저도 DNS 질의 결과를 캐싱하기 때문에 균등하게 부하분산 되지 않는다. DNS 레코드의 TTL 값을 짧게 설정함으로써 어느 정도 해소가 되지만, TTL 에 따라 캐시를 해제하는 것은 아니므로 반드시 주의가 필요하다.

3. 서버가 다운되어도 확인이 불가능하다.

   DNS 서버는 웹 서버의 부하나 접속 수 등의 상황에 따라 질의 결과를 제어할 수 없다. 웹 서버의 부하가 높아서 응답이 느려지거나 접속 수가 꽉 차서 접속을 처리할 수 없는 상황인지 전혀 감지할 수 없기 때문에 어떤 원인으로 다운되더라도 이를 검출하지 못하고 유저들에게 제공한다. 이 때문에 유저들은 간혹 다운된 서버로 연결이 되기도 한다. DNS Round Robin은 어디까지나 부하 분산을 위한 방법이지 다중화 방법은 아니므로 다른 S/W와 조합해서 관리할 필요가 있다.

   > 다중화란 장애가 발생해도 예비 운용장비로 시스템의 기능을 게속할 수 있도록 하는 것을 말한다.

### Round Robin 단점 극복 방법

- Synchronous Time-Division Multiplexing (다중화 구성 방식)
  - AP 서버에 VIP(Virtual IP)를 부여해서 다중화를 구성한다.
  - 각 AP 서버를 Health Check 후 이상이 감지되면 VIP를 정상 AP 서버로 인계하는 방식을 사용한다.
  - 즉, DNS Server Table에 실시간으로 AP 서버의 상태를 확인할 수 있는 칼럼 및 함수를 추가하여 요청될 경우 서버 상태를 확인 후 우회루트를 제공하거나 에러를 전송하는 방식이다.
- Weighted Round Robin (WRR)
  - 각각의 웹 서버에 가중치를 가미해서 분산 비율을 변경한다. 물론 가중치가 큰 서버일수록 빈번하게 선택되므로 처리 능력이 높은 서버는 가중치를 높게 설정하는 것이 좋다.
- Least Connection
  - Round Robin 방식을 기반으로 한다.
  - 접속 클라이언트 수가 가장 적은 서버를 선택한다.
  - 로드밸런서에서 실시간으로 connection 수를 관리하거나 각 서버에서 주기적으로 알려주는 것이 필요하다.

## 김민수

### DNS 라운드 로빈

- DNS는 도메인을 요청받아 ip주소를 반환해 주는 서버이다. 이때 DNS는 여러 유저에 대해 라운드 로빈 방식으로 ip를 할당한다.

### 라운드 로빈

- 시분할 시스템을 위해 설계된 선점형 스케줄링 방법

- 컨슈머들 사이에 우선순위를 두지 않고, 순서대로 시간단위로 자원을 분배한다.

### 장점

- 로드 밸런서가 필요하지 않다. 즉 부하에 대한 걱정이 사라진다.
- 적은 비용으로 트래픽 분산이 가능하다.

### 단점

- DNS 서버는 각각의 공인 ip를 반환하기 때문에 서버의 수에 맞게 공인 ip가 필요하다.
- 균등하게 분산되지 않는다. 특히 모바일 환경에서 캐리어 게이트웨이라는 프록시 서버를 경유하는데, 프록시 서버에서는 이름 변환 결과가 일정 기간 캐싱되므로 항상 같은 서버로 접속된다.
- DNS 서버는 웹 서버의 부하, 접속 수, 상태를 알지 못하므로 문제가 생긴 서버를 필터링하지 않고 제공한다.


## 이수형

### Round Robin DNS

일반적으로 하나의 도메인에 대응되는 공인 IP를 반환하나 일부의 경우 여러개의 공인 IP주소가 할당된다
이러한 방식을 Round Robin DNS라고 한다. 즉 별도의 장비나 소프트웨어 방식을 사용하지않고 서버가 각각의 공인 IP를 가지고 있고 사용자가 DNS에서 조회하는 시점에서 트래픽을 분산한다.

- 서버의 성능이 서로 동일할때 사용하는것이 좋음
- 세션이 오래 지속되지 않는 경우에 사용하는것이 좋음


장점

- 로드벨런서가 필요하지않아 비용적 부분이 줄어듦
- 간편하다
- 적은 비용으로 트래픽을 효과적으로 분산할 수 있음

단점

- 서버의 수만큼 공인 IP주소가 필요함
- 균등하게 분산되지 않음
- 서버에 이상이 있어도 부하를 분산시킴
- 서버가 다운되어도 확인이 불가능함
   - 다중화 구성방식을 통해 극복

> 로드벨런서 : 클라이언트로부터 전송되어온 요청을 실제 웹서버로 중계해주는 부하분산기<br/>
> 서버의 상태를 관찰하며 조절함<br/>
> Round Robin DNS에서 서버측면에서 다중화 구성을 했지만 로드벨런서는 그럴 필요가없음


## 윤기재

### DNS Round Robin
- DNS Round Robin은 서버에 요청을 보낼 때 DNS에 서버의 아이피를 요청한다는 점에 착안하여 만들어진 방법이다.



![RR](https://user-images.githubusercontent.com/37038119/135821708-cb37d2e7-3d26-4fff-a957-68b64eb29191.png)

서버는 각각의 공인 IP를 가지고 있고 사용자가 도메인을 통해 접속하는 순간

DNS에서 레코드 조회시 반환하는 하나의 공인 IP로 접속하게 된다. 

이러한 방식을 통해 자연스럽게 각 서버에 부하가 분배된다.


#### 실행순서
1. 클라이언트가 어떤 요청을 보내기 위해서 DNS에 서버의 아이피를 요청
2. DNS에서 각 서비스의 서버에 해당하는 ip를 round robin으로 제공

#### 장점
- 중간 장비(로드밸런서) 없이도 서비스가 가능하다
- 비용적인 부분이 적다.
- 간편하다.

#### 단점
- DNS에서 제공한 정보를 캐싱할 경우(웹 브라우저 및 모바일) 다른 IP주소를 제공해도 캐싱한 주소로 연결되기 때문에 부하분산이 제대로 이루어지지 않는 문제가 있다.

- 특정 서버가 다운되더라도 Round Robin 방식으로는 감지할 수 없기 때문에 유저에게 다운된 서버의 주소를 제공하는 경우가 발생할 수 있다.
