# TCP와 UDP의 차이점

### 우지현

TCP와 UDP가 나오게 된 배경

1. IP의 역할은 Host to Host (장치 to 장치)만을 지원한다. 장치에서 장치로의 이동은 IP로 해결되지만, 하나의 장비 안에서 수많은 프로그램들이 통신을 할 경우에는 IP만으로는 한계가 있다.

2. 또한, IP에서 오류가 발생한다면 ICMP에서 알려준다. 하지만 ICMP는 알려주기만 할 뿐 대처를 못하기 때문에 IP보다 위에서 처리를 해줘야 한다.

   > ICMP : Internet Control Message Protocol (인터넷 제어 메시지 프로토콜)
   > 네트워크 컴퓨터 위에서 돌아가는 운영체제에서 오류 메시지를 전송받는 데 주로 쓰임

1번을 해결하기 위해 포트 번호가 생겼고, 2번을 해결하기 위해 상위 프로토콜인 TCP와 UDP가 나오게 되었다.

<br />

TCP 

Transmission Control Protocol (전송제어 프로토콜)

TCP는 데이터의 분실, 중복, 순서가 뒤바뀜 등을 자동으로 보정해줘서 송수신 데이터의 정확한 전달을 할 수 있도록 해준다. 즉, 신뢰성과 순차적인 전달을 만족한다. TCP는 신뢰성이 없는 인터넷을 통해 종단간에 신뢰성 있는 바이트 스트림을 전송하도록 특별히 설계되었고 송신자와 수신자 모두가 소켓이라고 부르는 종단점을 생성함으로써 서비스가 이루어진다. TCP에서 연결 설정(connection establishment)은 3-way handshake를 통해 행해진다.

모든 TCP 연결은 전이중(full-duplex), 점대점(point to point) 방식이고 멀티캐스팅이나 브로드캐스팅을 지원하지 않는다.

> 전이중 (full-duplex) : 전송이 양방향으로 동시에 일어날 수 있음
> 점대점 (point to point) : 각 연결이 정확히 2개의 종단점을 가지고 있음

<br />

- 3-way handshake : 연결

  TCP는 정확한 전송을 보장해야 한다. 따라서 통신하기에 앞서, 논리적인 접속을 성립하기 위해 3-way handshake 과정을 진행한다. 신뢰성 있는 연결을 맺어주는 TCP의 3-way handshake 방식은 다음과 같다.

  <br />

  ![3-way handshake](https://t1.daumcdn.net/cfile/tistory/225A964D52F1BB6917)

  <br />

  [STEP 1] 

  A 클라이언트는 B 서버에 접속을 요청하는 SYN 패킷을 보낸다. 이때 A 클라이언트는 SYN을 보내고 SYN/ACK 응답을 기다리는 SYN_SENT 상태가 된다.

  [STEP 2]

  B 서버는 SYN 요청을 받고 A 클라이언트에게 요청을 수락한다는 ACK와 SYN flag가 설정된 패킷을 발송하고 A가 다시 ACK으로 응답하기를 기다린다. 이때 B 서버는 SYN_RECEIVED 상태가 된다.

  [STEP 3] 

  A 클라이언트는 B 서버에게 ACK를 보내고 이후로부터는 연결이 이루어지고 데이터가 오가게 된다. 이때의 B 서버 상태가 ESTABLISHED다. 

<br />

- 4-way handshake : 연결 해제

  3-way handshake는 TCP의 연결을 초기화할 때 사용한다면, 4-way handshake는 세션을 종료하기 위해 수행되는 절차다. 

  <br />

  ![4-way handshake](https://t1.daumcdn.net/cfile/tistory/2152353F52F1C02835)

  <br />

  [STEP 1]

  클라이언트가 연결을 종료하겠다는 FIN 플래그를 전송한다.

  [STEP 2]

  서버는 일단 확인 메시지를 보내고 자신의 통신이 끝날 때까지 기다리는데 이 상태가 TIME_WAIT 상태다.

  [STEP 3]

  서버가 통신이 끝났으면 연결이 종료되었다고 클라이언트에게 FIN 플래그를 전송한다.

  [STEP 4]

  클라이언트는 확인했다는 메시지를 보낸다.

  

  그런데 만약 "서버에서 FIN을 전송하기 전에 전송한 패킷이 Routing 지연이나 패킷 유실로 인한 재전송 등으로 인해 FIN 패킷보다 늦게 도착하는 상황"이 발생한다면?

  

  클라이언트에서 세션을 종료시킨 뒤 뒤늦게 도착하는 패킷이 있다면 이 패킷은 drop되고 데이터는 유실될 것이다. 이러한 현상에 대비하여 클라이언트는 서버로부터 FIN을 수신하더라도 일정시간(디폴트 240초) 동안 세션을 남겨놓고 잉여 패킷을 기다리는 과정을 거치게 되는데 이 과정이 "TIME_WAIT"다.

<br />

UDP 

User Datagram Protocol (사용자 데이터그램 프로토콜)

UDP는 비연결형 프로토콜으로 IP 데이터그램을 캡슐화하여 보내는 방법과 연결 설정을 하지 않고 보내는 방법을 제공한다. UDP는 흐름제어, 오류제어 또는 손상된 세그먼트의 수신에 대한 재전송을 하지 않으며, 이 모두는 사용자 프로세스의 몫으로 UDP는 포트들을 사용하여 IP 프로토콜에 인터페이스를 제공한다. 즉, UDP는 비연결형, 신뢰성 없는 전송 프로토콜이다.

종종 클라이언트는 서버로 짧은 요청을 보내고, 짧은 응답을 기대한다. 만약 요청 또는 응답이 손실된다면, 클라이언트는 time out 되고 다시 시도할 수 있으면 된다. 코드가 간단할 뿐만 아니라 TCP처럼 초기설정(initial setup)에서 요구되는 프로토콜보다 적은 메시지가 요구된다.

UDP의 장점은 데이터의 신속성이다. 데이터 처리가 TCP보다 빠르다. 주로 실시간 방송과 온라인 게임에서 사용되며 네트워크 환경이 안 좋을 때, 끊기는 현상을 생각하면 된다.

UDP를 사용하는 것들에는 DNS(Domain Name Service)가 있다.

> 왜 DNS는 UDP를 사용할까?
>
> - Request의 양이 작아서 UDP Request에 담을 수 있다.
>
> - TCP는 데이터를 송신할 때까지 세션 확립을 위한 처리를 하고, 송신한 데이터가 수신되었는지 점검하는 과정이 필요하지만 UDP는 3-way handshaking으로 연결을 유지할 필요가 없어 오버헤드가 작아진다.
>
> - Request에 대한 손실은 Application Layer에서 제어가 가능하다.
>
> - 하지만 Zone Transfer를 사용하거나 데이터가 512 bytes를 넘는 경우, 응답을 못 받은 경우는 TCP를 사용한다.
>
>   Zone Transfer : DNS 서버 간의 요청을 주고 받을 때 사용하는 transfer


### 이수형

TCP의 정의

인터넷상에서 데이터를 메세지의 형태로 보내기 위해 IP와 함께 사용하는 프로토콜

- 연결형 서비스로 가상 회선방식을 제공한다
  발신지와 수신지를 연결하여 패킷을 전송하기 위한 논리적 경로를 배정
- 수신여부를 확인함
- 높은 신뢰성을 보장한다
- UDP보다 속도가 느리다
- Full-Duplex, Point to Point 방식
- 3-way handshaking과정을 통해 연결을 설정하고 4-way handshaking을 통해 해제한다.

연속성보다 신뢰성이중요한 서비스 (파일 전송 등) 에 사용

UDP의 정의

데이터를 독립적인 관계를 지니는 패킷 단위로 처리하는 프로토콜

- 비연결형 프로토콜
  연결을 위해 할당되는 경로가 없음 

  각패킷은 다른경로로 전송되고 각각 독립적인 관계를 지님
- 정보를 주고받을때 신호절차를 거치치 않음
- 최소한의 오류만 검출함 (헤더의 CheckSum 필드)
- 신뢰성이 낮다
- TCP보다 속도가 빠르다

신뢰성보다 연속성이 중요한 서비스 ( 스트리밍 등 ) 에 사용

3-way handshaking

- TCP/IP프로토콜을 이용해서 통신을 하는 응용프로그램이 데이터를 전송하기 전에 먼저 정확한 전송을 보장하기 위해 상대방 컴퓨터와 사전에 세션을 수립하는 과정

4-way handshaking

- 3-Way handshake는 TCP의 연결을 초기화 할 때 사용한다면, 4-Way handshake는 세션을 종료하기 위해 수행되는 절차


### 이유진
TCP와 UDP는 TCP/IP의 전송계층에서 사용되는 프로토콜로 IP계층에서 알려준 정보 경로를 바탕으로 데이터의 실제 송수신을 담당한다. TCP와 UCP의 차이점은 연결(Connection)과 신뢰도(Unrliable)에 있다.
> **프로토콜** : 컴퓨터 네트워킹을 할 때 서로 약속하는 통신 규약

#### TCP (Transmission Control Protocol)
- 연결형 프로토콜
- 3-way handshaking을 통해 Connection을 형성한 뒤에 정보의 송수신이 이루어진다.
- 세그먼트가 유실될 경우 재전송을 통해 복구해준다.
- 순서 번호를 이용해 순서를 맞춰서 전달한다.

#### UDP (User Datagram Protocol)
- 비 연결형 프로토콜
- Connection설정 없이 바로 전송이 가능하다.
- 전송한 데이터그램이 유실 될 수 있고, 순서가 바뀌어 도착할 수 있다. (낮은 신뢰성)
- 상대적으로 빠르다.

#### 3-way Handshake (TCP Connection)
- TCP는 장치들 사이의 논리적인 접속을 성립하기 위해 3-way handshake를 사용한다. (반드시 필요)
- Client와 Server모두 데이터를 전송할 준비가 되었다는 것을 보장한다.
- 데이터를 전송하기 전에 정확한 전송을 보장하기 위해 컴퓨터와 사전에 세션을 수립하는 과정이다.
- Client > Server : TCP SYN  
Server > Client : TCP SYN ACK  
Client > Server : TCP ACK  
![image](https://user-images.githubusercontent.com/37680108/133107223-a69b6b2c-45e3-4714-81be-88d2b99e6100.png)

### 차세대 HTTP/3는 UDP를 사용한다
#### TCP의 문제점 
현재 HTTPS는 보안을 위해 TCP+TLS를 쓰는데, 핸드쉐이크 과정이 매우 복잡하고 최소 100ms시간이 소요된다. 반면 UDP는 핸드쉐이크 과정이 없으므로 빠르다.

#### QUIC(Quck UDP Internet Connections)
TCP의 성능을 개선하고자 UDP를 채택한 기술이다. 또한, UDP는 데이터 전송에만 초점을 맞추고 설계되어 헤더에 아무것도 없기 때문에 커스터마이징이 용이하다. 따라서 개발자의 구현에 따라 신뢰성을 높일 수 있고, 기능 확장이 쉽다.
- 전달 속도의 개선
- 클라이언트와 서버의 연결수 최소화
- 대역폭을 예상하여 패킷 혼잡(congestion)을 피함

> 참고 : [HTTP/3는 왜 UDP를 선택한 것일까?](https://evan-moon.github.io/2019/10/08/what-is-http3/) 


### 김현수

네트워크의 계층들 중 전송 계층에서 데이터를 보내기 위해 사용하는 프로토콜<br>
전송계층은 송신자와 수신자를 연결하는 통신서비스를 제공하는 계층으로, 쉽게 말해 데이터의 전달을 담당한다. 

### 1. TCP(Transmission Control Protocol)

- 전송을 제어하는 프로토콜(규약), 인터넷상에서 데이터를 메세지의 형태로 보내기 위해 IP와 함께 사용하는 프로토콜
- 일반적으로 TCP와 IP를 함께 사용하는데, IP가 데이터의 배달을 처리한다면 TCP는 패킷을 추적 및 관리한다. 
- 연결형 서비스를 지원하는 프로토콜로 인터넷 환경에서 기본으로 사용한다. 

#### 특징
- 연결형 서비스로 가상 회선 방식을 제공한다. : 발신지와 수신지를 연결하여 패킷을 전송하기 위한 논리적 경로를 배정
- 3-way handshaking과정을 통해 연결을 설정하고 4-way handshaking을 통해 해제한다.
   - 목적지와 수신지를 확실히 하여 정확한 전송을 보장하기 위해서 세션을 수립하는 과정을 의미
- 흐름 제어 및 혼잡 제어 -> UDP보다 속도가 느리다.
- 높은 신뢰성을 보장한다.
- 바이트 스트림을 통해 연결.
- 전이중, 점대점 방식
	- 전이중 (Full-Duplex) : 전송이 양방향으로 동시에 일어날 수 있다.
	- 점대점 (Point to Point) : 각 연결이 정확히 2개의 종단점을 가지고 있다.

#### TCP 서버의 특징
- 서버소켓은 연결만을 담당한다.
- 연결과정에서 반환된 클라이언트 소켓은 데이터의 송수신에 사용된다.
- 서버와 클라이언트는 1:1로 연결된다.
- 스트림 전송으로 전송 데이터의 크기가 무제한이다.
- 패킷에 대한 응답을 해야하기 때문에(시간 지연, CPU 소모) 성능이 낮다.
- Streaming 서비스에 불리하다.(손실된 경우 재전송 요청을 하므로)

> TCP Connection (3-way handshake)
> 1) 먼저 open()을 실행한 클라이언트가 SYN을 보내고 SYN_SENT 상태로 대기한다.
> 2) 서버는 SYN_RCVD 상태로 바꾸고 SYN과 응답 ACK를 보낸다.
> 3) SYN과 응답 ACK을 받은 클라이언트는 ESTABLISHED 상태로 변경하고 서버에게 응답 ACK를 보낸다.
> 4) 응답 ACK를 받은 서버는 ESTABLISHED 상태로 변경한다.

> TCP Disconnection (4-way handshake)
> 1) 먼저 close()를 실행한 클라이언트가 FIN을 보내고 FIN_WAIT1 상태로 대기한다.
> 2) 서버는 CLOSE_WAIT으로 바꾸고 응답 ACK를 전달한다. 동시에 해당 포트에 연결되어 있는 어플리케이션에게 close()를 요청한다.
> 3) ACK를 받은 클라이언트는 상태를 FIN_WAIT2로 변경한다.
> 4) close() 요청을 받은 서버 어플리케이션은 종료 프로세스를 진행하고 FIN을 클라이언트에 보내 LAST_ACK 상태로 바꾼다.
> 5) FIN을 받은 클라이언트는 ACK를 서버에 다시 전송하고 TIME_WAIT으로 상태를 바꾼다. TIME_WAIT에서 일정 시간이 지나면 CLOSED된다. ACK를 받은 서버도 포트를 CLOSED로 닫는다

### 2. UDP(User Datagram Protocol)

- 사용자 데이터그램 프로토콜(규약), 데이터를 독립적인 패킷 단위로 처리하는 프로토콜
- 비연결형 프로토콜 : 연결을 위해 할당되는 논리적인 경로가 없어 각각의 패킷은 다른 경로로 전송되고 독립적인 관계를 지니게 된다.

#### 특징
- 비연결형 서비스로 연결을 설정하고 해제하는 과정이 존재하지 않는다.
- 정보를 주고 받을 때 정보를 보내거나 받는다는 신호절차를 거치지 않는다.
- UDP헤더의 CheckSum 필드를 통해 최소한의 오류만 검출한다.
- 패킷에 순서를 부여하여 재조립을 하거나 흐름 제어 또는 혼잡 제어와 같은 기능도 처리하지 않는다.
	- 신뢰성이 낮다, TCP보다 속도가 빠르다, 네트워크 부하가 적다.
	- 신뢰성보다는 연속성이 중요한 서비스 (ex. 실시간 서비스(streaming))에 자주 사용된다.
- 메세지 스트림을 통해 연결

#### UDP 서버의 특징
- UDP에는 연결 자체가 없으므로(connect 함수 불필요) 서버 소켓과 클라이언트 소켓의 구분이 없다.
- 소켓 대신 IP를 기반으로 데이터를 전송한다.
- 서버와 클라이언트는 1대1, 1대N, N대M 등으로 연결될 수 있다.
- 데이터그램(메세지) 단위로 전송되며 그 크기는 65535바이트로, 크기가 초과하면 잘라서 보낸다.
- 흐름제어(flow control)가 없어서 패킷이 제대로 전송되었는지, 오류가 없는지 확인할 수 없다.


### 윤상일

#### TCP? UDP?

- TCP와 UDP는 OSI 표준모델과(물데네**★전★**세표응) TCP/IP 모델의 전송계층에서 사용되는 프로토콜이에요

![image](https://user-images.githubusercontent.com/76988389/133215254-e89d9880-78e3-4810-bcfa-3d649e5015d6.png)

- 여기서 전송계층은 데이터의 전달(송-수신자간 통신 서비스 제공, 패킷 검사, 재전송 요구 제어 등)을 담당해요
- 이 때 TCP는 송-수신자간 서로 데이터의 송수신이 완료되었다는 확인 메시지를 통해 통신의 신뢰성을 높여요
- 반면 UDP는 데이터 송수신 확인 절차 없이 그저 데이터를 보낼 뿐이에요

### TCP

- TCP(Transmission Control Protocol)은 연결 지향적 프로토콜이에요. 즉, 클라이언트와 서버가 연결된 상태에서 데이터를 주고받아요

  ![image](https://user-images.githubusercontent.com/76988389/133215282-032755d0-cf0d-4ed1-8ea2-7af056686e7b.png)

- TCP는 패킷을 성공적으로 전송하면 ACK라는 신호를 날리고, ACK가 제 시간에 도달하지 않으면 Timeout을 발생시켜요
- 위와 같이 3 way handshake 방식(SYN, ACK)를 통해 port에 연결하기 위해 3번의 요청/응답 후 연결이 돼요
- **장점**
  - 데이터의 전송 순서를 보장해요
  - 데이터를 정확하고 안정적으로 보낼 수 있어요
  - 데이터 흐름 제어와 혼잡 제어에 용이해요
- **단점**
  - 1:1 통신만 가능해요
  - 반드시 연결이 형성되어야 해요
  - 통신 선로의 길이에 UDP보다 영향을 많이 받아요

#### UDP

- UDP(User Datagram Protocol)는 전송계측의 비연결 지향적 프로토콜이에요

![image](https://user-images.githubusercontent.com/76988389/133215312-cd88a72b-7a03-4986-b290-828700f8aa49.png)

- 연결되지 않은 상태에서 발신자가 일방적으로 데이터를 전달해요
- **장점**
  - TCP보다 데이터의 전송이 빨라요
  - 패킷 오버헤드가 적어 네트워크 부하가 감소돼요
- **단점**
  - 데이터의 신뢰성이 없어요
  - 패킷의 송신 순서와 수신 순서가 다를 수 있어요
  - 패킷이 잘못된 선로로 전송되어 유실될 수 있어요
  - 의미있는 서버를 구축하기 위해 일일이 패킷을 관리해주어야 해요
