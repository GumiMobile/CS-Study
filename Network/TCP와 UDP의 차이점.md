# TCP와 UDP의 차이점

### 우지현

TCP와 UDP가 나오게 된 배경

1. IP의 역할은 Host to Host (장치 to 장치)만을 지원한다. 장치에서 장치로의 이동은 IP로 해결되지만, 하나의 장비 안에서 수많은 프로그램들이 통신을 할 경우에는 IP만으로는 한계가 있다.

2. 또한, IP에서 오류가 발생한다면 ICMP에서 알려준다. 하지만 ICMP는 알려주기만 할 뿐 대처를 못하기 때문에 IP보다 위에서 처리를 해줘야 한다.

   > ICMP : Internet Control Message Protocol (인터넷 제어 메시지 프로토콜)
   > 네트워크 컴퓨터 위에서 돌아가는 운영체제에서 오류 메시지를 전송받는 데 주로 쓰임

1번을 해결하기 위해 포트 번호가 생겼고, 2번을 해결하기 위해 상위 프로토콜인 TCP와 UDP가 나오게 되었다.

<br />

TCP 

Transmission Control Protocol (전송제어 프로토콜)

TCP는 데이터의 분실, 중복, 순서가 뒤바뀜 등을 자동으로 보정해줘서 송수신 데이터의 정확한 전달을 할 수 있도록 해준다. 즉, 신뢰성과 순차적인 전달을 만족한다. TCP는 신뢰성이 없는 인터넷을 통해 종단간에 신뢰성 있는 바이트 스트림을 전송하도록 특별히 설계되었고 송신자와 수신자 모두가 소켓이라고 부르는 종단점을 생성함으로써 서비스가 이루어진다. TCP에서 연결 설정(connection establishment)은 3-way handshake를 통해 행해진다.

모든 TCP 연결은 전이중(full-duplex), 점대점(point to point) 방식이고 멀티캐스팅이나 브로드캐스팅을 지원하지 않는다.

> 전이중 (full-duplex) : 전송이 양방향으로 동시에 일어날 수 있음
> 점대점 (point to point) : 각 연결이 정확히 2개의 종단점을 가지고 있음

<br />

- 3-way handshake : 연결

  TCP는 정확한 전송을 보장해야 한다. 따라서 통신하기에 앞서, 논리적인 접속을 성립하기 위해 3-way handshake 과정을 진행한다. 신뢰성 있는 연결을 맺어주는 TCP의 3-way handshake 방식은 다음과 같다.

  <br />

  ![3-way handshake](https://t1.daumcdn.net/cfile/tistory/225A964D52F1BB6917)

  <br />

  [STEP 1] 

  A 클라이언트는 B 서버에 접속을 요청하는 SYN 패킷을 보낸다. 이때 A 클라이언트는 SYN을 보내고 SYN/ACK 응답을 기다리는 SYN_SENT 상태가 된다.

  [STEP 2]

  B 서버는 SYN 요청을 받고 A 클라이언트에게 요청을 수락한다는 ACK와 SYN flag가 설정된 패킷을 발송하고 A가 다시 ACK으로 응답하기를 기다린다. 이때 B 서버는 SYN_RECEIVED 상태가 된다.

  [STEP 3] 

  A 클라이언트는 B 서버에게 ACK를 보내고 이후로부터는 연결이 이루어지고 데이터가 오가게 된다. 이때의 B 서버 상태가 ESTABLISHED다. 

<br />

- 4-way handshake : 연결 해제

  3-way handshake는 TCP의 연결을 초기화할 때 사용한다면, 4-way handshake는 세션을 종료하기 위해 수행되는 절차다. 

  <br />

  ![4-way handshake](https://t1.daumcdn.net/cfile/tistory/2152353F52F1C02835)

  <br />

  [STEP 1]

  클라이언트가 연결을 종료하겠다는 FIN 플래그를 전송한다.

  [STEP 2]

  서버는 일단 확인 메시지를 보내고 자신의 통신이 끝날 때까지 기다리는데 이 상태가 TIME_WAIT 상태다.

  [STEP 3]

  서버가 통신이 끝났으면 연결이 종료되었다고 클라이언트에게 FIN 플래그를 전송한다.

  [STEP 4]

  클라이언트는 확인했다는 메시지를 보낸다.

  

  그런데 만약 "서버에서 FIN을 전송하기 전에 전송한 패킷이 Routing 지연이나 패킷 유실로 인한 재전송 등으로 인해 FIN 패킷보다 늦게 도착하는 상황"이 발생한다면?

  

  클라이언트에서 세션을 종료시킨 뒤 뒤늦게 도착하는 패킷이 있다면 이 패킷은 drop되고 데이터는 유실될 것이다. 이러한 현상에 대비하여 클라이언트는 서버로부터 FIN을 수신하더라도 일정시간(디폴트 240초) 동안 세션을 남겨놓고 잉여 패킷을 기다리는 과정을 거치게 되는데 이 과정이 "TIME_WAIT"다.

<br />

UDP 

User Datagram Protocol (사용자 데이터그램 프로토콜)

UDP는 비연결형 프로토콜으로 IP 데이터그램을 캡슐화하여 보내는 방법과 연결 설정을 하지 않고 보내는 방법을 제공한다. UDP는 흐름제어, 오류제어 또는 손상된 세그먼트의 수신에 대한 재전송을 하지 않으며, 이 모두는 사용자 프로세스의 몫으로 UDP는 포트들을 사용하여 IP 프로토콜에 인터페이스를 제공한다. 즉, UDP는 비연결형, 신뢰성 없는 전송 프로토콜이다.

종종 클라이언트는 서버로 짧은 요청을 보내고, 짧은 응답을 기대한다. 만약 요청 또는 응답이 손실된다면, 클라이언트는 time out 되고 다시 시도할 수 있으면 된다. 코드가 간단할 뿐만 아니라 TCP처럼 초기설정(initial setup)에서 요구되는 프로토콜보다 적은 메시지가 요구된다.

UDP의 장점은 데이터의 신속성이다. 데이터 처리가 TCP보다 빠르다. 주로 실시간 방송과 온라인 게임에서 사용되며 네트워크 환경이 안 좋을 때, 끊기는 현상을 생각하면 된다.

UDP를 사용하는 것들에는 DNS(Domain Name Service)가 있다.

> 왜 DNS는 UDP를 사용할까?
>
> - Request의 양이 작아서 UDP Request에 담을 수 있다.
>
> - TCP는 데이터를 송신할 때까지 세션 확립을 위한 처리를 하고, 송신한 데이터가 수신되었는지 점검하는 과정이 필요하지만 UDP는 3-way handshaking으로 연결을 유지할 필요가 없어 오버헤드가 작아진다.
>
> - Request에 대한 손실은 Application Layer에서 제어가 가능하다.
>
> - 하지만 Zone Transfer를 사용하거나 데이터가 512 bytes를 넘는 경우, 응답을 못 받은 경우는 TCP를 사용한다.
>
>   Zone Transfer : DNS 서버 간의 요청을 주고 받을 때 사용하는 transfer

