# 교착상태

## 김민수

### 교착상태란? (Dead Lock)

두 개 이상의 작업이 서로 상대방의 작업이 끝나기 만을 기다리고 있기 때문에 아무 것도 완료되니 못하는 상태를 가르킨다.

### 교착상태의 발생조건

교착상태가 발생할 조건은 아래 4가지 조건을 모두 만족해야 한다. 반대로 말하면 4가지 조건 중 하나라도 만족하지 않으면 교착상태는 발생하지 않는다.

- 상호 배제
  - 한 번에 프로세스 하나만 해당 자원을 독점적으로 사용한다. 사용 중인 자원을 다른 프로세스가 사용하려면 요청한 자원이 해제될 때까지 기다려야 한다.
- 점유 대기
  - 자원을 최소한 하나 보유하고, 다른 프로세스에 할당된 자원을 점유하기 위해 대기하는 프로세스가 존재해야 한다.
- 비선점
  - 이미 할당된 자원을 강제로 빼앗을 수 없다.
- 순환 대기
  - 대기 프로세스의 집합이 순환 형태로 자원을 대기하고 있어야 한다.

### 교착상태 처리방법

- 교착상태를 미리 예방

  - 자원 할당 시 4가지 조건 중 어느 하나가 만족되지 않도록 한다.

    1. 상호 배제 : 공유해서는 안되는 자원의 경우 상호배제를 피할 수 없다. 보통 나머지 조건들을 통해 예방한다.

    2. 점유 대기: 프로세스가 자원을 요청할 때 다른 어떤 자원도 가지고 있지 않아야 한다.

       e.g 1. 프로세스 시작 시 필요한 모든 자원을 할당 받는다.

       e.g 2. 자원이 필요할 경우 보유 자원을 반납하고 다시 요청한다.

    3. 비선점: 프로세스가 어떤 자원을 기다려야 하는 경우 이미 보유한 자원이 선점된다.(보유 자원을 뺏긴다. 보유 자원은 save, restore가 쉬워야 한다.)

    4. 순환 대기: 모든 자원에 할당 순서를 정하여 정해진 순서대로만 자원 할당

       e.g 순서가 3인 자원 Ri를 보유한 프로세스가 순서가 1인 자원 Rj를 할당 받기 위해서는 우선 Ri를 반납해야 한다.

  - 문제점: 자원 이용률 저하, 시스템 처리율 감소, 기아 문제

- 교착상태 발생을 회피

  - 자원 요청에 대한 부가적인 정보를 이용해서 교착상태의 가능성이 없는 경우에만 자원을 할당한다.
  - 시스템 state가 원래 state로 돌아올 수 있는 경우에만 자원을 할당한다.
  - [은행원 알고리즘](#은행원-알고리즘)

- 교착상태 탐지 및 회복

  - 교착상태 발생은 허용하나, 그에 대한 탐지 루틴을 두어 교착상태를 회복시킨다.
  - 교착상태 프로세스 전부 끄거나, 교착상태가 풀릴 때까지 프로세스를 하나씩 끈다.

- 교착상태 무시

  - 교착상태를 시스템이 책임지지 않는다.
  - UNIX를 포함한 대부분의 OS가 채택

#### 은행원 알고리즘

- 가정
  - 모든 프로세스는 자원의 최대 사용량을 미리 명시
  - 프로세스가 요청 자원을 모두 할당받은 경우 유한 시간 안에 이들 자원을 다시 반납한다.
- 방법
  - 자원 요청시 safe 상태를 유지할 경우에만 자원 할당
  - 총 요청 자원의 수가 가용 자원의 수 보다 적은 프로세스를 선택, 없으면 unsafe
  - 선택한 프로세스에게 자원 할당
  - 프로세스가 종료되면 모든 자원을 반납
  - 모든 프로세스가 종료될 때까지 과정 반복

<img src="https://user-images.githubusercontent.com/80962918/137317394-38aa383f-cded-40ea-96ab-40c7d05f15ee.png" style width="600"/>

|          | step 1       | step 2       | step 3       | step 4 | step 5 |
| -------- | ------------ | ------------ | ------------ | ------ | ------ |
| 가용자원 | 3 3 2        | 5 3 2        | 7 4 3        | 7 4 5  | 9 4 5  |
| P0       | x            | x            | o            | o      | o      |
| P1       | o            | -            | -            | -      | -      |
| P2       | x            | x            | o            | o      | -      |
| P3       | o            | o            | -            | -      | -      |
| P4       | x            | o            | o            | -      | -      |
| 결과     | P1 선택 반납 | P3 선택 반납 | P4 선택 반납 | P2     | P0     |

</br>

## 김현수

### 교착상태(Deadlock)란?
- 상호배제에 의해 나타나는 문제점으로, 다중 프로그래밍 시스템에서 여러 프로세스들이 공유하고 있는 일부 자원들을 점유하고 놓지 않으면서 다른 프로세스가 가지고 있는 자원들을 원하여 무한정으로 기다리고 있는 상태
- 프로세스 상태전이도의 프로세스 상태 중 Asleep 상태에 해당
	- 프로세스가 실행하기 위해 필요한 자원을 갖지 못한 상태이므로 Asleep 상태 또는 Suspended Blocked 상태로도 될 수 있으며, 자원을 다시 얻게 되면 Wake up 된다.

### 교착상태의 발생 조건
1. 상호배제(Mutual Exclusion, Mutex)
	- 둘 이상의 프로세스가 임계 영역에 동시에 접근하는 것을 금지시키는 기법.
2. 점유와 대기(Hold and Wait)
	- 자원을 가지고 있는 상태에서 다른 프로세스가 사용하고 있는 자원의 반납을 기다리는 것.
3. 비선점(Non Preemptive)
	- 다른 프로세스의 자원을 강제로 가져올 수 없음
4. 환형대기(Circular Wait)
	- 각 프로세스가 순환적으로 다음 프로세스가 요구하는 자원을 가지고 있는 것
	
### 교착상태 해결 방법
1. 예방(Prevention)
	- 교착상태의 발생 조건은 위의 네 가지 조건을 모두 만족시키는 경우이므로 교착상태를 해결하기 위해서는 네 조건 중 하나만 해결하면 된다.
2. 회피(Avoidance)
	- 교착상태의 발생조건을 없애기보다는 발생하지 않도록 알고리즘을 적용하는 방법
	- ex. 자원할당 그래프 알고리즘, 은행원 알고리즘
3. 회복(Recovery)
	- 교착상태가 발생하는 것을 아예 막지 않고, 만약 교착상태가 발생하면 발생 이후에 문제를 해결하는 방법
4. 무시(Ignore)
	- 교착상태를 해결할때에도 믄맥교환에 의한 오버헤드로 성능 저하가 생긴다.
	- 따라서 교착상태에 의한 성능 저하보다 이를 해결할 때의 성능저하가 더 큰 경우엔 그냥 무시한다.
