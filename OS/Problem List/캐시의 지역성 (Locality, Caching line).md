# 캐시의 지역성 (Locality, Caching line)

## 김민수

### 캐시의 지역성

캐시가 효율적으로 동작하려면 저장할 데이터가 지역성을 가져야 한다. 캐시의 성능은 적중률 (Hit ratio)에 의해 결정된다.

> 적중률 Hit ratio
>
> 캐시 메모리 적중 횟수 / 전체 메모리 참조 횟수. 실패율은 1 - 적중율이다.

- 시간적 지역성

  특정 데이터가 한번 접근되었을 경우, 가까운 미래에 다시 접근될 확률이 높은 것을 말한다.

  e.g LRU, 공통 변수

- 공간적 지역성

  특정 데이터와 가까운 주소가 순서대로 접근되는 경우를 말한다. 이때 특정 데이터 뿐만 아니라 주변 블럭 전체를 캐싱하여 성능을 높힌다. 

  e.g for 문과 같은 순차적 실행, 배열

- 순차적 지역성

  데이터가 순차적으로 접근되는 경향으로, 명령어들은 저장된 순서대로 인출되어 실행된다. 공간적 지역성에 포함되어 설명하기도 한다.

### Caching line

캐시 메모리는 메인 메모리에 비해 저장 공간이 매우 작다. 따라서 메인 메모리의 데이터를 캐시 메모리에 1대1 대응 시킬 수 없다. 또한 캐시 메모리의 데이터 위치를 특정하지 못하면 캐시 메모리 전체를 순회해야하기 때문에 성능이 나빠진다. 따라서 캐시메모리에 저장할 때, 특정 자료구조를 이용하여 데이터 묶음를 저장하는데 이를 캐싱라인이라 한다.

- Direct mapping

  직접 매핑으로, 메인 메모리를 일정한 크기의 블록으로 나눠 캐시의 정해진 위치에 블록 단위로 저장한다. 간단하며구현이 쉽다.

  하지만 적중율이 낮아 질 수 있고 같은 캐시 메모리 주소에 할당된 데이터를 사용할 때 충돌이 생길 수 있다.

  ![img](https://blog.kakaocdn.net/dn/KWMR2/btrgjyIn1ns/mvER1WQu1w7kI4BuHbQCqk/img.png)

- Full associative mapping

  캐시 메모리 공간에 임의로 저장하는 방법이다. 저장은 매우 쉬우나 데이터 탐색 시, 모든 태그를 병렬적으로 검사해야한다. 따라서 탐색 과정이 복잡하고 비용이 높다.

- Set associative mapping

  앞선 두가지 방식을 혼용한 방법으로 미리 정해둔 특정 위치들 중 임의로 저장한다. Direct mapping에 비해 검색 속도는 느리지만 저장이 빠르고 Full associative mapping 보단 저장이 느리지만 검색이 빠르다. 주로 사용하는 방법이다.

## 이수형

### 캐시의 지역성

캐시 메모리는 CPU가 어떤 데이터를 원할것인가에 대해 어느정도 예측할 수 있어야된다
이때 적중율을 극대화 시키기 위해서 사용되는것이 지역성의 원리이다.

시간의 지역성

- 현재 참조된 기억장소는 미래에도 계속 참조될 가능성이 높음

공간의 지역성

- 하나의 기억장소가 참조되면 근처의 기억장소가 계속 참조될 가능성이 높음

### Caching line

캐시가 아무리 가까이 있어도 찾고자 하는 데이터가 어느곳에 저장되어 있는지를 모른다면 효율적이지 않기 때문에 캐시에 데이터를 저장 할때는 태그의 묶음으로 저장하게 되고 이를 Caching line이라고 한다

1. Direct Mapping
   
   주기억장치의 블록들이 지정된 한 개의 캐시 라인으로 블록단위로 정해진 위치에 매핑 

   장점 : 구현이 쉽고 비용이 적음<br/>
   단점 : 적중률이 낮아질 수 있음, 동일한 인덱스 필드 값을 가진 다수의 메모리 주소를 함께 저장할 수 없음(address conflict)

2. Full Associative Mapping

   Direct Mapping의 단점을 보완한 방식 모든 태그들을 병렬로 검사
   
   단점 : 저장은 쉬우나 과정이 복잡함, 데이터에 특별한 순서가 없으므로 검색하는데 추가 비용이 많이 듦


3. Set Associative Mapping

    Direct Mapping과 Full Associative Mapping의 장점만을 취한 방식
    
    Direct Mapping에서 동일 인덱스 필드의 메모리 영역 데이터를 함께 공유할 수 없다는 단점을 극복하기 위해 마련되었음 
    
    여러 개의 set으로 구성되어있고 Main memory의 block들은 들어갈 set은 정해져있지만 set 내에서는 어디로 들어가든 상관 없음
   
   
저장속도 : Full Associative > Set Associative > Direct

검색속도 : Direct > Set Asoociative > Full Associative
